<section class="user-management">
  <header class="page-header">
    <div>
      <p class="eyebrow">Access control</p>
      <h1>User management</h1>
      <p class="subtitle">Invite users, assign roles, and review access activity.</p>
    </div>
    <div class="header-actions">
      <button class="ghost">Export</button>
      <button class="primary" (click)="openInvite()">Onboard user</button>
    </div>
  </header>

  <section class="panel">
    <div class="panel-header">
      <h2>Active users</h2>
      <div class="filters">
        <input
          type="search"
          placeholder="Search name or email"
          [(ngModel)]="searchTerm"
          name="searchTerm"
        />
        <select [(ngModel)]="roleFilter" name="roleFilter">
          <option value="">All roles</option>
          <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
        </select>
      </div>
    </div>

    <div class="table-row heading">
      <span>Name</span>
      <span>Email</span>
      <span>Phone</span>
      <span>Department</span>
      <span>Role</span>
      <span>Status</span>
      <span>Last active</span>
      <span>Actions</span>
    </div>
    <div class="table-row" *ngFor="let user of filteredUsers">
      <span>{{ user.firstName }} {{ user.lastName }}</span>
      <span>{{ user.email }}</span>
      <span>{{ user.phone || 'â€”' }}</span>
      <span>{{ user.department }}</span>
      <span>{{ user.role }}</span>
      <span
        class="status"
        [class.active]="user.status === 'Active'"
        [class.pending]="user.status === 'Pending'"
        [class.suspended]="user.status === 'Suspended'"
      >
        {{ user.status }}
      </span>
      <span>{{ user.lastActive }}</span>
      <span class="actions">
        <button class="ghost small" type="button" (click)="openEdit(user)">Edit</button>
        <button class="ghost small" type="button" (click)="resetPassword(user)">
          Reset password
        </button>
      </span>
    </div>
  </section>

  <div class="modal-backdrop" *ngIf="showInviteModal">
    <div class="modal">
      <header>
        <h2>Onboard user</h2>
        <button class="icon" type="button" (click)="closeInvite()">Close</button>
      </header>
      <form class="modal-form" #onboardFormRef="ngForm" (ngSubmit)="onboardUser(onboardFormRef)">
        <div class="field">
          <label>First name <span class="req">*</span></label>
          <input
            type="text"
            name="firstName"
            [(ngModel)]="onboardForm.firstName"
            placeholder="First name"
            required
          />
        </div>
        <div class="field">
          <label>Last name <span class="req">*</span></label>
          <input
            type="text"
            name="lastName"
            [(ngModel)]="onboardForm.lastName"
            placeholder="Last name"
            required
          />
        </div>
        <div class="field">
          <label>Email ID <span class="req">*</span></label>
          <input
            type="email"
            name="email"
            [(ngModel)]="onboardForm.email"
            placeholder="name@company.com"
            required
          />
        </div>
        <div class="field">
          <label>Phone number</label>
          <input
            type="tel"
            name="phone"
            [(ngModel)]="onboardForm.phone"
            placeholder="Optional"
          />
        </div>
        <div class="field">
          <label>Department <span class="req">*</span></label>
          <select name="department" [(ngModel)]="onboardForm.department" required>
            <option value="">Select department</option>
            <option *ngFor="let department of departments" [value]="department">
              {{ department }}
            </option>
          </select>
        </div>
        <div class="field">
          <label>Role <span class="req">*</span></label>
          <select name="role" [(ngModel)]="onboardForm.role" required>
            <option value="">Select role</option>
            <option>Auditor</option>
            <option>Manager</option>
            <option>Super Admin</option>
          </select>
        </div>
        <div class="field">
          <label>Create password <span class="req">*</span></label>
          <input
            type="password"
            name="password"
            [(ngModel)]="onboardForm.password"
            placeholder="Set a temporary password"
            required
          />
        </div>
        <div class="field">
          <label>Status <span class="req">*</span></label>
          <select name="status" [(ngModel)]="onboardForm.status" required>
            <option value="">Select status</option>
            <option>Active</option>
            <option>Pending</option>
            <option>Suspended</option>
          </select>
        </div>
        <div class="field">
          <label>Last active</label>
          <input type="text" placeholder="Set after first login" disabled />
        </div>
      </form>
      <footer>
        <button class="ghost" type="button" (click)="closeInvite()">Cancel</button>
        <button
          class="primary"
          type="submit"
          [disabled]="onboardFormRef.invalid"
        >
          Onboard user
        </button>
      </footer>
      <p class="error" *ngIf="onboardError">{{ onboardError }}</p>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showEditModal && selectedUser">
    <div class="modal">
      <header>
        <h2>Edit user</h2>
        <button class="icon" type="button" (click)="closeEdit()">Close</button>
      </header>
      <form class="modal-form" *ngIf="editForm">
        <div class="field">
          <label>First name <span class="req">*</span></label>
          <input
            type="text"
            name="editFirstName"
            [(ngModel)]="editForm.firstName"
            required
          />
        </div>
        <div class="field">
          <label>Last name <span class="req">*</span></label>
          <input
            type="text"
            name="editLastName"
            [(ngModel)]="editForm.lastName"
            required
          />
        </div>
        <div class="field">
          <label>Email ID</label>
          <input type="email" [value]="editForm.email" disabled />
        </div>
        <div class="field">
          <label>Phone number</label>
          <input
            type="tel"
            name="editPhone"
            [(ngModel)]="editForm.phone"
            placeholder="Optional"
          />
        </div>
        <div class="field">
          <label>Department <span class="req">*</span></label>
          <input
            type="text"
            name="editDepartment"
            [(ngModel)]="editForm.department"
            required
          />
        </div>
        <div class="field">
          <label>Role <span class="req">*</span></label>
          <select name="editRole" [(ngModel)]="editForm.role" required>
            <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
          </select>
        </div>
        <div class="field">
          <label>Status <span class="req">*</span></label>
          <select name="editStatus" [(ngModel)]="editForm.status" required>
            <option value="Active">Active</option>
            <option value="Pending">Pending</option>
            <option value="Suspended">Suspended</option>
          </select>
        </div>
        <div class="field">
          <label>Last active</label>
          <input type="text" [value]="editForm.lastActive" disabled />
        </div>
      </form>
      <footer>
        <button class="ghost" type="button" (click)="closeEdit()">Cancel</button>
        <button class="primary" type="button" (click)="saveEdit()">Save changes</button>
      </footer>
    </div>
  </div>
</section>
