<section class="page">
  <header class="page-header">
    <div>
      <p class="eyebrow">Customer workspace</p>
      <h1>Customer dashboard</h1>
      <p>Track your audit progress, evidence, NCs, and reports.</p>
    </div>
    <div class="header-actions">
      <a class="ghost" routerLink="/reports">View reports</a>
    </div>
  </header>

  <section class="summary">
    <article class="summary-card">
      <span>Total audits</span>
      <strong>{{ totalAudits }}</strong>
    </article>
    <article class="summary-card">
      <span>In progress</span>
      <strong>{{ inProgressAudits.length }}</strong>
    </article>
    <article class="summary-card">
      <span>Completed</span>
      <strong>{{ completedAudits.length }}</strong>
    </article>
    <article class="summary-card">
      <span>Open NCs</span>
      <strong>{{ openNcRecords.length }}</strong>
    </article>
  </section>

  <section class="card">
    <div class="card-header">
      <div>
        <h2>Your audits</h2>
        <p>Progress and evidence access by audit.</p>
      </div>
      <span class="count">{{ audits.length }} audits</span>
    </div>
    <div class="audit-grid" *ngIf="audits.length; else noAudits">
      <article class="audit-card" *ngFor="let audit of audits">
        <div class="audit-meta">
          <span>{{ audit.auditType }}</span>
          <span>·</span>
          <span>{{ audit.auditSubtype || '—' }}</span>
        </div>
        <h3>{{ audit.code }}</h3>
        <p class="audit-range">{{ formatDate(audit.startDate) }} → {{ formatDate(audit.endDate) }}</p>
        <div class="progress">
          <div class="progress-label">
            <span>{{ progressLabel(audit) }}</span>
            <span>{{ progressPercent(audit) }}%</span>
          </div>
          <div class="progress-bar">
            <span [style.width.%]="progressPercent(audit)"></span>
          </div>
        </div>
        <div class="audit-actions">
          <a class="secondary" [routerLink]="['/evidence', audit.code]">Evidence</a>
          <a class="ghost" routerLink="/reports">Report</a>
        </div>
      </article>
    </div>
    <ng-template #noAudits>
      <div class="empty">No audits assigned yet.</div>
    </ng-template>
  </section>

  <section class="card">
    <div class="card-header">
      <div>
        <h2>NC overview</h2>
        <p>Track NC status for your audits.</p>
      </div>
      <span class="count">{{ ncService.records().length }} NCs</span>
    </div>
    <div class="nc-list" *ngIf="ncService.records().length; else noNc">
      <article class="nc-card" *ngFor="let record of ncService.records()">
        <div class="nc-title">
          <strong>{{ record.auditCode }}</strong>
          <span class="status" [class.open]="isOpenNc(record)">
            {{ record.status || 'Assigned' }}
          </span>
        </div>
        <p>{{ record.question || '—' }}</p>
        <div class="nc-meta">
          <span>{{ record.assignedNc || '—' }}</span>
          <span>{{ record.assignedUserName || record.assignedUserEmail || 'Unassigned' }}</span>
        </div>
      </article>
    </div>
    <ng-template #noNc>
      <div class="empty">No NCs for your audits yet.</div>
    </ng-template>
  </section>
</section>
