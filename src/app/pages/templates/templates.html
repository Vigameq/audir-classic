<section class="templates">
  <header class="page-header">
    <div>
      <p class="eyebrow">Audit templates</p>
      <h1>Templates</h1>
      <p class="subtitle">Import spreadsheet questions for audit execution.</p>
    </div>
    <div class="header-actions">
      <button class="primary" type="button" (click)="openImportModal()">
        Import
      </button>
    </div>
  </header>

  <section class="panel" *ngIf="templates.length">
    <div class="panel-header">
      <h2>Saved templates</h2>
      <span class="count">{{ templates.length }} total</span>
    </div>
    <div class="template-list">
      <article class="template-item" *ngFor="let template of templates" (click)="toggleTemplate(template.id)">
        <div>
          <h3>{{ template.name }}</h3>
          <p>{{ template.questions.length }} questions</p>
          <p class="note-text" *ngIf="template.note">{{ template.note }}</p>
          <div class="tag-list" *ngIf="template.tags.length">
            <span class="tag" *ngFor="let tag of template.tags">{{ tag }}</span>
          </div>
          <ol class="question-list" *ngIf="expandedTemplateId === template.id">
            <li *ngFor="let question of template.questions">{{ question }}</li>
          </ol>
        </div>
        <div class="template-meta">
          <button
            class="ghost small delete"
            type="button"
            (click)="$event.stopPropagation(); deleteTemplate(template.id)"
          >
            Delete
          </button>
          <span class="meta">{{ template.createdAt | date:'mediumDate' }}</span>
        </div>
      </article>
    </div>
  </section>

  <div class="modal-backdrop" *ngIf="showImportModal">
    <div class="modal">
      <header>
        <h2>Import questions</h2>
        <button class="icon" type="button" (click)="closeImportModal()">Close</button>
      </header>
      <div class="modal-body">
        <p class="hint">Upload a single-sheet .xlsx with one column of questions.</p>
        <button class="ghost file-button" type="button">
          Choose file
          <input type="file" accept=".xlsx" (change)="onFileSelected($event)" />
        </button>
        <p class="file-name" *ngIf="selectedFileName">{{ selectedFileName }}</p>
        <div class="note">
          <label>Template name (optional)</label>
          <input
            type="text"
            name="templateName"
            [(ngModel)]="templateName"
            placeholder="Template name"
          />
        </div>
        <div class="note">
          <label>Import note (optional)</label>
          <textarea
            rows="2"
            maxlength="100"
            placeholder="Add up to 100 characters"
            name="importNote"
            [(ngModel)]="importNote"
            (input)="updateNoteChars(importNote)"
          ></textarea>
          <div class="note-meta">
            <span>Optional note saved with this import.</span>
            <span [class.limit]="noteChars >= 100">{{ noteChars }}/100</span>
          </div>
        </div>
        <div class="tags">
          <label>Tags (up to 3)</label>
          <div class="tag-input">
            <input
              type="text"
              name="tagInput"
              [(ngModel)]="tagInput"
              placeholder="Add a tag"
              [disabled]="tags.length >= 3"
            />
            <button class="ghost" type="button" (click)="addTag()" [disabled]="tags.length >= 3">
              Add tag
            </button>
          </div>
          <div class="note-meta">
            <span>{{ tags.length }}/3 tags used</span>
          </div>
          <div class="tag-list" *ngIf="tags.length">
            <span class="tag" *ngFor="let tag of tags">
              {{ tag }}
              <button type="button" class="remove" (click)="removeTag(tag)">Ã—</button>
            </span>
          </div>
        </div>
        <p class="error" *ngIf="createError">{{ createError }}</p>
      </div>
      <footer>
        <button class="ghost" type="button" (click)="closeImportModal()">Cancel</button>
        <button class="primary" type="button" (click)="createTemplate()">
          Create template
        </button>
      </footer>
    </div>
  </div>
</section>
